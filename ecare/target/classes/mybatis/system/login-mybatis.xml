<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.ecare.web.system.login">
    
    
    
	<!--查询信息详情-->
    <select id="findUserInfo" resultType="pd" parameterType="pd">
    	select 
    		a.id as "id",
    		a.login_name as "login_name",
    		a.login_password as "login_password",
    		a.user_name as "user_name",
    		a.sex as "sex",
    		a.email as "email",
    		a.phone as "phone",
    		a.head_address as "head_address",
    		a.digital_account as "digital_account",
    		a.type as "type",
    		a.order_by as "order_by",
    		a.status as "status",
    		a.remark as "remark",
    		a.organize_id as "organize_id",
    		a.remove_logo as "remove_logo",
    		a.create_user as "create_user",
    		a.create_time as "create_time",
    		a.wearth_city_id as "wearth_city_id",
    		a.update_time as "update_time"
    	 from system_user a
    	 where a.remove_logo = 'N' and a.status='Y'
    	 and a.login_name = #{login_name}
    </select>
    
    
    
    <select id="findUserPath" parameterType="pd" resultType="String">
    	select
    		group_concat(d.user_id) as "user_id"
    		from system_role a
    		left join system_role_menu b on a.id=b.role_id or b.role_id in (#{role_ids})
    		left join system_menu c on b.menu_id=c.id
    		left join system_user_role d on a.id=d.role_id
    		where c.url like concat('%', #{path},'%')
    </select>
    
    
    <!--查询用户组织id-->
    <select id="findUserorganizeinfo" resultType="pd" parameterType="pd">
    	select
			a.id as "id",
			a.user_id as "user_id",
			a.organize_id as "organize_id",
			a.create_user as "create_user",
			a.create_time as "create_time",
			b.name as "organize_name",
			b.org_cascade as "org_cascade"
		from system_user_organize a
		left join system_organize b on a.organize_id = b.id
		where a.user_id=#{user_id}
    </select>
    
    <!--获取施工单位组织ID  -->
    <select id="findUnitOrgId" parameterType="pd" resultType="Integer">
    	select
    		organize_id
    		from construction_unit_account 
    		where account_id=#{user_id}
    </select>
    
    <!--更新信息-->
    <update id="update" parameterType="pd">
    	update system_user set 
    		<if test="login_name != null and login_name != '' ">
				login_name=#{login_name},
			</if>
			<if test="login_password != null and login_password != '' ">
				login_password=#{login_password},
			</if>
			<if test="user_name != null and user_name != '' ">
				user_name=#{user_name},
			</if>
			<if test="sex != null and sex != '' ">
				sex=#{sex},
			</if>
			<if test="head_address != null and head_address != '' ">
				head_address=#{head_address},
			</if>
			<if test="email != null and email != '' ">
				email=#{email},
			</if>
			<if test="phone != null and phone != '' ">
				phone=#{phone},
			</if>
			<if test="head_address != null and head_address != '' ">
				head_address=#{head_address},
			</if>
			<if test="digital_account != null and digital_account != '' ">
				digital_account=#{digital_account},
			</if>
			<if test="type != null and type != '' ">
				type=#{type},
			</if>
			<if test="order_by != null and order_by != '' ">
				order_by=#{order_by},
			</if>
			<if test="status != null and status != '' ">
				status=#{status},
			</if>
			<if test="remark != null and remark != '' ">
				remark=#{remark},
			</if>
    		<if test="remove_logo != null and remove_logo != '' ">
				remove_logo=#{remove_logo},
			</if>
			<if test="wearth_city_id != null and wearth_city_id != '' ">
				wearth_city_id=#{wearth_city_id},
			</if>
			<if test="session_id != null and session_id != '' ">
				session_id=#{session_id},
			</if>
    		update_time=#{update_time}
    		where id=#{id}
    		
    </update>
    
</mapper>
