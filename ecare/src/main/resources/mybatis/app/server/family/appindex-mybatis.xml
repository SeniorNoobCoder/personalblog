<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.ecare.app.server.appindex">
	
	<!-- 查询轮播图 -->
	<select id="findCarouseList"  parameterType="pd" resultType="pd">
		SELECT
			a.id as "id",
			a.title as "title",
			a.image_href as "image_href",
			a.action_url as "action_url",
			a.status as "status",
			a.order_by as "order_by",
			a.remark as "remark"
		FROM
			app_mall_photo a
		where a.remove_logo="N" and a.status='1'
	
	</select>
	
	<!-- 查询根服务、查询优选服务、生活服务2级（点击生活服务出现的信息）、点击家政服务查询的服务分类信息 -->
	<select id="findRootList" parameterType="pd" resultType="pd">
		SELECT
			a.id as "id",
			a.name as "name",
			a.parent_id as "parent_id",
			a.level as "level",
			a.image as "image",
			a.url as "url",
			a.remark as "remark",
			a.type as "type"
		FROM
			server_category a
		where a.remove_logo="N"
		<if test="level != null and level != '' ">
			and a.level=#{level}
		</if>
		<if test="show_app != null and show_app != '' ">
			and a.show_app= #{show_app}
		</if>
		<if test="parent_id != null and parent_id != '' ">
			and a.parent_id=#{parent_id}
		</if>
		<if test="id != null and id != '' ">
			and a.id=#{id}
		</if>
	</select>
	
	<!-- 热门服务 -->
	<select id="findHotList" parameterType="page" resultType="pd">
		SELECT
			min(starting_price) as "starting_price",
			a.id as "id",
			a.title as "title",
			a.content as "content",
			a.server_category_id as "server_category_id",
			a.server_category_name as "server_category_name",
			a.partner_id as "partner_id",
			a.partner_name as "partner_name",
			c.head_address as "head_address",
			c.is_authent as "is_authent",
			a.status as "status"
		FROM
			server_info a
		LEFT JOIN server_category_detail b on b.server_category_id =a.server_category_id
		left join partner_user c on a.operator_id=c.id
		where a.remove_logo="N" and a.status="2"
			order by a.create_time desc
			<if test="endPage != null and endPage != ''">
	   			limit #{startPage},#{endPage}
   			</if>
	</select>
	
	<!-- 热门服务的数量 -->
	<select id="findHotNum" resultType="Integer" parameterType="pd">
		SELECT
		min(starting_price) as "starting_price",
		a.id as "id",
		a.title as "title",
		a.content as "content",
		a.server_category_id as "server_category_id",
		a.server_category_name as "server_category_name",
		a.partner_id as "partner_id",
		a.partner_name as "partner_name",
		c.head_address as "head_address",
		c.is_authent as "is_authent",
		a.status as "status"
		FROM
		server_info a
		LEFT JOIN server_category_detail b on b.server_category_id =a.server_category_id
		left join partner_user c on a.operator_id=c.id
		where a.remove_logo="N" and a.status="2"
		order by a.create_time desc
		<if test="endPage != null and endPage != ''">
			limit #{startPage},#{endPage}
		</if>
    </select>
	
	
	
	<!-- 查看热门服务详情(服务介绍） -->
	<select id="findHotInfo" parameterType="pd" resultType="pd">
		SELECT
			b.starting_price as "starting_price",
			c.head_address as "head_address",
			b.price as "price",
			b.charge_mode_time as "charge_mode_time",
			b.charge_mode_unit as "charge_mode_unit",
			b.pay_type as "pay_type",
			b.is_approve as "is_approve",
			b.work_hours as "work_hours",
			b.remark as "remark",
			c.is_authent as "is_authent",
			b.server_category_id as "server_category_id",
			b.id as "id"
		FROM
			server_info a
		LEFT JOIN server_category_detail b on b.server_category_id =a.server_category_id
		left join partner_user c on a.operator_id=c.id
		where a.remove_logo="N" and a.status="2"
		<if test="server_category_id != null and server_category_id != '' ">
			and a.server_category_id=#{server_category_id}
		</if>
	</select>
	
	<!-- 查看热门服务详情 -->
	<select id="findInfo" parameterType="pd" resultType="pd">
	SELECT
		a.id,
		a.title,
		a.content,
		a.server_category_id,
		a.server_category_name,
		b.user_name,
		b.phone,
		b.head_address,
		b.address,
		b.is_authent,
		c.start_price,
		a.partner_id
		FROM server_info  a
		LEFT JOIN partner_user b
		ON a.partner_id= b.id
		LEFT JOIN server_category c
		ON a.server_category_id = c.id
		WHERE a.id = #{id}
	</select>
	

	
	<!-- 获取服务分类信息（用于查找这个服务分类信息下的信息也就是server_info表中的信息） -->
		<select id="findRootInfo" parameterType="pd" resultType="pd">
		SELECT
			a.id as "id",
			a.name as "name",
			a.parent_id as "parent_id",
			a.level as "level",
			a.image as "image",
			a.url as "url",
			a.remark as "remark",
			a.type as "type"
		FROM
			server_category a
		where a.remove_logo="N" and a.show_app="Y" 
		<if test="level != null and level != '' ">
			and a.level=#{level}
		</if>
		<if test="id != null and id != '' ">
			and a.id=#{id}
		</if>
		<if test="parent_id != null and parent_id != '' ">
			and a.parent_id=#{parent_id}
		</if>
	</select>
	
	<!-- 服务信息server_info的信息 -->
	<select id="findServerList" parameterType="pd" resultType="pd">
		SELECT
			a.id AS id,
			a.title AS title,
			a.content AS content,
			a.server_category_name AS server_category_name,
			p.head_address AS head_address,
			p.is_authent AS is_authent,
			d.authent_name AS companyName,
			p.address AS companyAddress,
			b.start_price AS start_price,
			p.phone AS companyPhone,
			p.county,
			p.city,
			p.province
		FROM
		server_info a
		LEFT JOIN server_category b ON a.server_category_id = b.id
		LEFT JOIN partner_user p ON a.partner_id = p.id
		LEFT JOIN partner_user_authent d ON p.id = d.partner_id
		WHERE a.remove_logo="N" and a.status="2"
		<if test="towLevelId != null and towLevelId != '' ">
			AND b.id = #{towLevelId}
		</if>
		<if test="county != null and county != '' ">
			AND p.county = #{county}
		</if>
		<if test="city != null and city != '' ">
			AND p.city = #{city}
		</if>
		<if test="province != null and province != '' ">
			AND p.province = #{province}
		</if>
		<if test="oneLevelId != null and oneLevelId != '' ">
			AND b.parent_id = #{oneLevelId}
		</if>
	 	<if test="companyName != null and companyName != '' ">
			 and d.authent_name like concat('%', #{companyName},'%')
		</if> 
		order by a.create_time desc
		<if test="endPage != null and endPage != ''">
			limit #{startPage},#{endPage}
		</if>
	</select>
	<!-- 服务信息server_info的信息 -->
	<select id="findServerListCount" parameterType="pd" resultType="Integer">
		SELECT count(*)
		FROM server_info a
		LEFT JOIN server_category b ON a.server_category_id = b.id
		LEFT JOIN partner_user p ON a.partner_id = p.id
		LEFT JOIN partner_user_authent d ON p.id = d.partner_id
		WHERE a.remove_logo="N" and a.status="2" 
				<!-- 二级分类查询 -->
		<if test="towLevelId != null and towLevelId != '' ">
			AND b.id = #{towLevelId}
		</if>
	 		<!-- 一级分类查询 -->
		<if test="oneLevelId != null and oneLevelId != '' ">
			AND b.parent_id = #{oneLevelId}
		</if>
		<if test="title != null and title != '' ">
			and a.title like concat('%', #{title},'%')
		</if>
		<if test="county != null and county != '' ">
			AND p.county = #{county}
		</if>
		<if test="city != null and city != '' ">
			AND p.city = #{city}
		</if>
		<if test="province != null and province != '' ">
			AND p.province = #{province}
		</if>
		order by a.create_time desc
		<if test="endPage != null and endPage != ''">
			limit #{startPage},#{endPage}
		</if>
	</select>
	<!-- 工作分类 -->
	<select id="findJobList" parameterType="pd" resultType="pd">
		SELECT
			server_category.`name`,
			server_category.id
		FROM
			server_category
		WHERE type = "detail" AND remove_logo = "N"
		<if test="parent_id != null and parent_id != '' ">
			AND  parent_id = #{parent_id}
		</if>
	</select>
	<!-- 工作分类描述 -->
	<select id="findJobRemarkList" parameterType="pd" resultType="pd">
		SELECT
			server_category_detail.remark,
			server_category_detail.work_hours,
			server_category_detail.starting_price,
			server_category_detail.price,
			server_category_detail.charge_mode_time,
			server_category_detail.charge_mode_unit,
			server_category_detail.pay_type,
			server_category_detail.is_approve
			FROM server_category_detail
			WHERE remove_logo = 'N'
			<if test="server_category_id != null and server_category_id != '' ">
				AND  server_category_id = #{server_category_id}
			</if>
			ORDER BY create_time
	</select>
	
	<!-- 收藏信息 -->
	<select id="findCollectNum" parameterType="pd" resultType="Integer">
		SELECT
		count(*)
		FROM customer_server_collect a
			where a.server_info_id=#{server_info_id} and a.user_id=#{user_id} 
	</select>
	
	<!-- 服务详情里边的评价信息(第一条) -->
	<select id="findPjInfo" parameterType="pd" resultType="pd">
		SELECT
			c.id as "id",
			a.id as "pId",
			a.service_quality as "service_quality",
			a.count as "plcount",
			a.service_attitude as "service_attitude",
			c.title as "servertitle",
			a.is_punctuality as "is_punctuality",
			c.content as "servercontent",
			a.create_time as "create_time",
			c.server_category_name as "server_category_name"
		FROM
			customer_order_assessment  a
			LEFT JOIN server_info c on c.id=a.server_info_id
			where 1=1
				<if test="id != null and id != '' ">
					and c.id=#{id}
				</if>
					ORDER BY
			a.create_time DESC
		LIMIT 1	
	</select>
	
	<!-- 评价列表 -->
	<select id="findPjList" parameterType="pd" resultType="pd">
		SELECT
			c.id as "id",
			a.id as "pId",
			a.service_quality as "service_quality",
			a.count as "plcount",
			a.service_attitude as "service_attitude",
			c.title as "servertitle",
			a.is_punctuality as "is_punctuality",
			a.create_time as "create_time",
			c.content as "servercontent",
			c.server_category_name as "server_category_name"
		FROM
			customer_order_assessment  a
			LEFT JOIN server_info c on c.id=a.server_info_id
			where 1=1
				<if test="id != null and id != '' ">
					and c.id=#{id}
				</if>
	</select>
	
	<!-- 评价数量 -->
	<select id="findPjListNum" parameterType="pd" resultType="Integer">
		SELECT
			count(0)
		FROM
			customer_order_assessment  a
			LEFT JOIN server_info c on c.id=a.server_info_id
			where 1=1
				<if test="id != null and id != '' ">
					and c.id=#{id}
				</if>
	</select>
	
	<!-- 查询地区 -->
	<select id="findAreaList" parameterType="pd" resultType="pd">
		SELECT
			a.id as "areaId",
			a.name,
			a.parent_id,
			a.type,
			a.adcode,
			a.citycode
		FROM
			system_area a
			where 1=1 and a.remove_logo='N' 
		<if test="onearealId != null and onearealId != '' ">
			and a.parent_id = #{onearealId}
		</if>
		<if test="parent_id != null and parent_id != '' ">
			and a.parent_id = #{parent_id}
		</if>
			<if test="name != null and name != '' ">
			and a.name like concat('%', #{name},'%')
		</if>
		order by a.create_time desc
	</select>
	
	<!-- 查询地区的信息 -->
	<select id="findAreaInfo" parameterType="pd" resultType="pd">
		SELECT
			a.id,
			a.parent_id,
			a.name,
			a.level,
			a.type
		FROM
			system_area a
			where 1=1 and a.remove_logo='N'  and (a.level='2'or  a.level='1')
		<if test="id != null and id != '' ">
			and a.id = #{id}
		</if>
		<if test="name != null and name != '' ">
			and a.name like concat('%', #{name},'%')
		</if>
		
	</select>
	
	
	
</mapper>