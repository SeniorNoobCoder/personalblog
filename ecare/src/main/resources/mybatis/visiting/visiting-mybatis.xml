<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.ecare.web.visiting.visiting">
    <!--查询信息列表-->
    <select id="findListPage" resultType="pd" parameterType="page">
        SELECT
        *
        FROM
        customer_visiting
        WHERE
        1 = 1
        <if test="pd.type != null and pd.type != ''">
            and type=#{pd.type}
        </if>
        <if test="pd.operator_id != null and pd.operator_id != ''">
            and operator_id=#{pd.operator_id}
        </if>
        <if test="pd.start_time != null and pd.start_time != ''and pd.end_time != null and pd.end_time != ''">
            and DATE_FORMAT(create_time,'%Y-%m-%d') BETWEEN #{pd.start_time} AND #{pd.end_time}
        </if>
        ORDER BY create_time DESC
    </select>
    <!--查询信息详情-->
    <select id="findInfo" resultType="pd" parameterType="pd">
        SELECT
	      *
        FROM
            customer_visiting
        WHERE
             a.id=#{id}
    </select>
    <!--删除信息-->
    <delete id="delete" parameterType="String">
        DELETE FROM customer_visiting where id=#{id}
    </delete>
    <!--保存-->
    <insert id="save" parameterType="pd">
        INSERT INTO customer_visiting (
            call_record_id,
            customer_name,
            customer_phone,
            operator_id,
            operator_name,
            create_time,
            remark,
            type
        )
        VALUES
        (
            #{call_record_id},
            #{customer_name},
            #{customer_phone},
            #{operator_id},
            #{operator_name},
            NOW(),
            #{remark},
            #{type})
        </insert>
    <select id="findNum" parameterType="pd" resultType="Integer">
        SELECT
        COUNT(0) AS num
        FROM
        customer_visiting a
        WHERE 1=1
        <if test="create_time != null and create_time != '' ">
            AND a.create_time LIKE  #{create_time}"%"
        </if>
    </select>
</mapper>